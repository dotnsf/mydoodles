<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8"/>
<title><%= __('common.header.title') %></title>
<script type="text/javascript" src="//code.jquery.com/jquery-2.2.4.min.js"></script>
<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet"/>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="//cdn.datatables.net/t/bs-3.3.6/jqc-1.12.0,dt-1.10.11/datatables.min.css"/> 
<script src="//cdn.datatables.net/t/bs-3.3.6/jqc-1.12.0,dt-1.10.11/datatables.min.js"></script>
<link href="//use.fontawesome.com/releases/v5.8.1/css/all.css" rel="stylesheet"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>

<link rel="shortcut icon" href="/icon.png" type="image/png"/>
<link rel="icon" href="/icon.png" type="image/png"/>
<link rel="apple-touch-icon" href="/icon.png"/>

<meta name="viewport" content="width=device-width,initial-scale=1"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black"/>
<meta name="apple-mobile-web-app-title" content="My Doodles"/>

<!-- // OGP tags -->
<meta property="og:title" content="My Doodles"/>
<meta property="og:type" content="website"/>
<meta property="og:url" content="https://mydoodles.mybluemix.net/"/>
<meta property="og:image" content="https://mydoodles.mybluemix.net/icon.png"/>
<meta property="og:site_name" content="My Doodles - <%= __('common.appdesc') %>"/>
<meta property="og:description" content="My Doodles : お絵描き共有サービス"/>
<!-- OGP tags // -->

<!-- // Twitter Card -->
<meta property="twitter:card" content="summary"/>
<meta property="twitter:site" content="@dotnsf"/>
<meta property="twitter:creator" content="@dotnsf"/>
<meta property="twitter:url" content="https://mydoodles.mybluemix.net/"/>
<meta property="twitter:image" content="https://mydoodles.mybluemix.net/icon.png"/>
<meta property="twitter:title" content="My Doodles - <%= __('common.appdesc') %>"/>
<meta property="twitter:description" content="My Doodles : お絵描き共有サービス"/>
<!-- Twitter Card // -->

<style type="text/css">
html, body{
  text-align: center;
  background-color: #fafafa;
  font-size: 20px;
  color: #333;
}
</style>
</head>
<body>
<div class="container">
  <table class="table table-bordered" id="view_table">
    <thead>
      <tr><th>#</th><th>uuid</th></th><th>title</th><th>datetime</th><th>actions</th></tr>
    </thead>
    <tbody>
<% for ( var i = 0; i < images.length; i ++ ){ %>
      <tr>
        <td><a target="_blank" href="/doodle/<%= images[i]._id %>"><img src="/attachment/<%= images[i]._id %>" width="40%"/></a></td>
        <td><a target="_blank" href="/doodle/<%= images[i]._id %>"><%= images[i].uuid %></a></td>
        <td><a target="_blank" href="/doodle/<%= images[i]._id %>"><%= images[i].title %></a></td>
        <td><a target="_blank" href="/doodle/<%= images[i]._id %>"><%= images[i].datetime %></a></td>
        <td><button class="btn btn-xs btn-danger" onClick="deleteImage('<%= images[i]._id %>');"><%= __('common.deleteimage.button') %></button></td>
      </tr>
<% } %>
    </tbody>
  </table>
</div>

<script>
$(function(){
  $.extend( $.fn.dataTable.defaults, {
    language: {
      url: '//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Japanese.json'
    }
  });
  $('#view_table').DataTable({
    columnDefs: [{ 
      targets: [ 0, 4 ], 
      orderable: false,
      searchable: false
    }],
    order: [ [ 3, 'desc' ] ]
  });
});

function deleteImage( id ){
  if( window.confirm( "<%= __('common.deleteimage.confirm1') %>" + id + "<%= __('common.deleteimage.confirm2') %>" ) ){
    $.ajax({
      type: "DELETE",
      url: "./image/" + id,
      success: function( data ){
        location.href = '/view';
      },
      error: function( jqXHR, textStatus, errorThrown ){
        console.log( textStatus + " : " + errorThrown );
      }
    });
  }
}

function timestamp2datetime( ts ){
  if( ts ){
    var dt = new Date( ts );
    var yyyy = dt.getFullYear();
    var mm = dt.getMonth() + 1;
    var dd = dt.getDate();
    var hh = dt.getHours();
    var nn = dt.getMinutes();
    var ss = dt.getSeconds();
    var datetime = yyyy + '-' + ( mm < 10 ? '0' : '' ) + mm + '-' + ( dd < 10 ? '0' : '' ) + dd
      + ' ' + ( hh < 10 ? '0' : '' ) + hh + ':' + ( nn < 10 ? '0' : '' ) + nn + ':' + ( ss < 10 ? '0' : '' ) + ss;
    return datetime;
  }else{
    return "";
  }
}
</script>
</body>
</html>
